# Exact Code Changes Needed (Copy-Paste Ready)\n\n## CHANGE #1: Auto-Calculate Delivery Time\n**File:** `server/routes.ts`  \n**Find:** Line ~1000, look for comment \"Roti category validation\"\n**Replace this section:**\n\n```typescript\n// Roti category validation - SIMPLE LOGIC\nconst isRotiCategory = sanitized.categoryName?.toLowerCase() === 'roti' || \n                       sanitized.categoryName?.toLowerCase().includes('roti');\n\nif (isRotiCategory) {\n  const now = new Date();\n  const currentHour = now.getHours();\n  const currentMinutes = now.getMinutes();\n  \n  // SIMPLE: Block if 8 AM - 11 AM\n  if (currentHour >= 8 && currentHour < 11) {\n    console.log(`üö´ Roti order blocked - current time ${currentHour}:00 is within 8 AM - 11 AM block`);\n    return res.status(403).json({\n      message: \"üö´ Roti orders blocked 8 AM - 11 AM. Chef prepares in advance. Order after 11 AM or before 8 AM.\",\n      isBlocked: true,\n    });\n  }\n  \n  // SIMPLE: Auto-set delivery time based on slot selection\n  if (sanitized.deliverySlotId) {\n    const slot = await storage.getDeliveryTimeSlot(sanitized.deliverySlotId);\n    if (!slot) {\n      return res.status(400).json({ message: \"Selected delivery slot not found\" });\n    }\n    \n    // Check if slot time has already passed TODAY\n    const [slotHour, slotMinute] = slot.startTime.split(':').map(Number);\n    const slotTotalMinutes = slotHour * 60 + slotMinute;\n    const nowTotalMinutes = currentHour * 60 + currentMinutes;\n    \n    if (slotTotalMinutes <= nowTotalMinutes) {\n      // Slot time already passed - schedule for NEXT DAY at this slot time\n      console.log(`üìÖ Slot time passed, auto-scheduling for next day at ${slot.startTime}`);\n      sanitized.deliveryTime = slot.startTime;\n    } else {\n      // Slot time is in future today - use slot time for today\n      console.log(`‚úÖ Slot time available today at ${slot.startTime}`);\n      sanitized.deliveryTime = slot.startTime;\n    }\n  } else {\n    // No slot selected - auto-calculate: now + 1 hour\n    const deliveryTime = new Date(now);\n    deliveryTime.setHours(deliveryTime.getHours() + 1);\n    const deliveryHour = String(deliveryTime.getHours()).padStart(2, '0');\n    const deliveryMinute = String(deliveryTime.getMinutes()).padStart(2, '0');\n    sanitized.deliveryTime = `${deliveryHour}:${deliveryMinute}`;\n    console.log(`‚è∞ No slot selected: auto-set delivery time to ${sanitized.deliveryTime} (1 hour from now)`);\n  }\n}\n```\n\n---\n\n## CHANGE #2: Verify Chef Notification\n**File:** `server/adminRoutes.ts`  \n**Find:** Line ~315-320, look for \"Scheduled delivery order detected\"\n**Replace this section:**\n\n```typescript\nif (paymentStatus === \"confirmed\") {\n  // Also update order status to confirmed\n  const confirmedOrder = await storage.updateOrderStatus(orderId, \"confirmed\");\n\n  if (confirmedOrder) {\n    console.log(`‚úÖ Admin confirmed payment for order ${orderId} - Broadcasting to chef ${confirmedOrder.chefId}`);\n    \n    // Broadcast to ALL connected clients (chef, admin, customer, etc)\n    broadcastOrderUpdate(confirmedOrder);\n    \n    // For scheduled delivery orders, log that chef should see this\n    if (confirmedOrder.deliveryTime && confirmedOrder.deliverySlotId && confirmedOrder.chefId) {\n      console.log(`üìã Scheduled delivery order confirmed - Chef ${confirmedOrder.chefId} should receive notification`);\n      console.log(`   Delivery Time: ${confirmedOrder.deliveryTime}, Slot: ${confirmedOrder.deliverySlotId}`);\n    }\n  }\n}\n```\n\n---\n\n## CHANGE #3: Verify Scheduled Tab Filtering\n**File:** `client/src/pages/partner/PartnerDashboard.tsx`  \n**Find:** Look for TabsContent value=\"scheduled\"\n**Verify it uses `scheduledOrders` not `orders`:**\n\n```tsx\n<TabsContent value=\"scheduled\">\n  <div className=\"space-y-2\">\n    {scheduledOrders.length === 0 ? (\n      <Card>\n        <CardContent className=\"pt-6 text-center text-muted-foreground\">\n          No scheduled orders yet\n        </CardContent>\n      </Card>\n    ) : (\n      scheduledOrders.map((order: Order) => (\n        // Display scheduled order with delivery time\n        <ScheduledOrderCard key={order.id} order={order} />\n      ))\n    )}\n  </div>\n</TabsContent>\n```\n\n---\n\n## CHANGE #4: Verify Checkout Button Disable\n**File:** `client/src/components/CheckoutDialog.tsx`  \n**Find:** Line ~1287, look for \"disabled={\"\n**Verify it includes `isRotiOrderBlocked`:**\n\n```tsx\n<Button\n  type=\"submit\"\n  onClick={handleSubmit}\n  disabled={\n    isLoading ||\n    !isFormValid ||\n    (phoneExists && !userToken) ||\n    cart?.chefIsActive === false ||\n    isRotiOrderBlocked  // ‚Üê This should be here\n  }\n  className=\"w-full sm:w-auto\"\n>\n  {isLoading ? (\n    <>Loading...</>\n  ) : isRotiOrderBlocked ? (\n    \"üö´ Roti Not Available Now\"  // ‚Üê Shows this text when blocked\n  ) : (\n    `Pay ‚Çπ${total.toFixed(2)}`\n  )}\n</Button>\n```\n\n---\n\n## Summary of Changes\n\n| Change | File | Lines | Impact |\n|--------|------|-------|--------|\n| Auto-calc delivery time | `routes.ts` | ~1000-1050 | Orders now have deliveryTime set automatically |\n| Chef notification verify | `adminRoutes.ts` | ~315-320 | Confirms chef gets notified on payment confirm |\n| Tab filtering verify | `PartnerDashboard.tsx` | TabsContent | Only scheduled orders in Scheduled tab |\n| Button disable verify | `CheckoutDialog.tsx` | ~1287-1300 | Button shows \"Not Available\" during 8-11 AM |\n\n---\n\n## Testing After Changes\n\n### Test 1: Build\n```bash\nnpm run build\n# Should succeed with no errors\n```\n\n### Test 2: Run\n```bash\nnpm run dev\n# Should start on port 5000\n```\n\n### Test 3: Morning Block\n```\n- Current time 9:30 AM\n- Add Roti to cart\n- Click Checkout\n- Button should say \"üö´ Roti Not Available Now\" and be disabled\n```\n\n### Test 4: Delivery Time Auto-Calc\n```\n- Current time 2:30 PM\n- Add Roti, don't select slot\n- Place order\n- Check admin: order.deliveryTime should be ~3:30 PM\n```\n\n### Test 5: Chef Notification  \n```\n- Chef logged in at /partner\n- Admin confirms payment for scheduled order\n- Chef should see toast notification\n- Order appears in Scheduled tab\n```\n\n---\n\n## If You Need More Help\n\nAll the changes are in these 4 files:\n1. `server/routes.ts` - Main change (auto-calc delivery time)\n2. `server/adminRoutes.ts` - Verify notification \n3. `client/src/components/CheckoutDialog.tsx` - Verify button disable\n4. `client/src/pages/partner/PartnerDashboard.tsx` - Verify tab filtering\n\nEach change is independent and can be applied one at a time.\n\n**Ready to go! üöÄ**\n"